<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sitterMapper">
	<sql id="sitterColumn"> sitter_id , sitter_password, sitter_name, sitter_Phone, sitter_email, sitter_addr,sitter_detail_addr,sitter_introduce,
		sitter_grade,sitter_certification,sitter_pet_amount,sitter_basis_price,sitter_permit
	</sql>
	<sql id="sitterOptionColumn"> 
		sitter_option_id, option_id
	</sql>
	
	<!--  1:1의 관계 매핑 하기 -->
	<resultMap type="sitterOptionDTO" id="sitterOptionJoinOption">
		<id column="sitter_option_id" property="sitterOptionId"/>
		<result column="sitter_id" property="sitterId"/>
		<association property="optionsDTO" javaType="optionsDTO">
			<id column="option_id" property="optionId"/>
			<result column="optionName" property="optionName"/>
		</association>
	</resultMap>
	
	<select id="selectAllPermittedSitter" resultType="sitterDTO">
		select
		<include refid="sitterColumn" />
		from sitter
		where sitter_permit='Y'
	</select>
	
	<select id="selectSitterOption" parameterType="String" resultMap="sitterOptionJoinOption"> 
		select sitter_option_id, sitter_id, o.option_id, o.option_name 
		from sitter_option s join options o 
		on	o.option_id = s.option_id
		where sitter_id = #{_parameter}
	</select>
	
	<select id="selectSittersByOpGrade" parameterType="Map" resultType="sitterDTO">
		select <include refid="sitterColumn" />
		from sitter
		where 
		<if test="#{grade}!=null">
			(sitter_grade >= #{grade}) and 
		</if>
		sitter_id in 
		(select DISTINCT sitter_id from sitter_Option 
		<if test="#{opList.size}!=null">
			where option_id in
			<foreach collection="opList" open="(" close=")" item="item" separator=",">
				#{item}
			</foreach>
		</if>
		 ) and
		sitter_permit='Y'
	</select>
	
<!-- 	<select id="selectSittersByOpGrade" resultType="sitterDTO">
	select
		<include refid="sitterColumn" />
		from sitter
		where sitter_permit='Y'
	</select> -->
</mapper>